<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="it">
<head>
    <meta charset="UTF-8">
    <title>Dettagli Prodotto</title>
    <!-- <link rel="stylesheet" href="/css/styles.css">  Stile CSS -->
</head>
<body>
<div class="prodotto">
<header>

    <h1 th:text="${product.nome}">Nome del prodotto</h1>
</header>
<main>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


    <section>
        <img th:src="@{/images/{name}(name=${product.immagine})}" alt="Immagine del prodotto" style="max-width: 300px;" />
        <video th:src="@{/videos/{name}(name=${product.video})}" controls th:if="${product.video != null}" style="max-width: 500px;"></video>

        <p><strong>Descrizione:</strong> <span th:text="${product.descrizione}">Descrizione del prodotto</span></p>
        <p><strong>Prezzo:</strong> €<span th:text="${product.prezzo}">0.00</span></p>
        <p><strong>Casa produttrice:</strong> <span th:text="${product.casaProd}">Casa Produttrice</span></p>
        <p><strong>Piattaforma:</strong> <span th:text="${product.piattaforma}">Piattaforma</span></p>
        <p><strong>Genere:</strong> <span th:text="${product.genere}">Genere</span></p>
        <p><strong>Tipo:</strong> <span th:text="${product.tipo}">Tipo</span></p>
        <p><strong>Data di rilascio:</strong> <span th:text="${#dates.format(product.dataRilascio, 'dd/MM/yyyy')}">Data di rilascio</span></p>
        <p><strong>Disponibilità:</strong> <span th:text="${product.quantita > 0 ? 'Disponibile' : 'Non disponibile'}">Disponibilità</span></p>

        <div>
            <form th:action="@{/aggiungi/{nome}(nome=${product.nome})}" method="POST">
                <input type="hidden" name="nome" th:value="${product.nome}">
                <button type="button" class="aggiungi-carrello" th:attr="data-nome-prodotto=${product.nome}">Aggiungi al carrello</button>
            </form>
            <div id="success-message" class="message" style="display: none; color: green;">
                Prodotto aggiunto al carrello!
            </div>
            <div id="error-message" class="error" style="display: none; color: red;">
                Si è verificato un errore durante l'aggiunta al carrello.
            </div>
        </div>

        <script th:inline="javascript">
            $(document).ready(function () {
                // Gestisce il clic sul pulsante "Aggiungi al carrello"
                $('.aggiungi-carrello').off('click').on('click', function (e) {
                    e.preventDefault();

                    // Recupera il nome del prodotto dall'attributo data
                    var nomeProdotto = $(this).data('nome-prodotto');
                    var url = "/aggiungi/" + encodeURIComponent(nomeProdotto);

                    // Effettua una richiesta AJAX per aggiungere il prodotto al carrello
                    $.ajax({
                        url: url,
                        type: "POST",
                        data: { nome: nomeProdotto },
                        success: function (response) {
                            // Mostra il messaggio di successo
                            $('#success-message').text('Prodotto aggiunto al carrello!').fadeIn().delay(3000).fadeOut();
                        },
                        error: function (xhr, status, error) {
                            // Mostra un messaggio di errore
                            $('#error-message').text('Si è verificato un errore durante l\'aggiunta al carrello: ' + error).fadeIn().delay(3000).fadeOut();
                        }
                    });
                });
            });
        </script>


    </section>

    <a href="/catalogo/prodotti">Torna al catalogo</a>
</main>
</div>
</body>

</html>
